---
import LanguageSelector from './LanguageSelector.astro';

interface NavLink {
  label: string;
  href: string;
  openInNewTab?: boolean;
}

interface Props {
  homeHref: string;
  brandLogoUrl?: string | null;
  brandLogoAlt?: string | null;
  brandDisplayName: string;
  navLinks?: NavLink[] | null;
  availableLocales: string[];
  currentLocale: string;
  currentPath: string;
  accentColor: string;
  showLanguageSelector?: boolean;
}

const {
  homeHref,
  brandLogoUrl,
  brandLogoAlt,
  brandDisplayName,
  navLinks: navLinksProp = [],
  availableLocales,
  currentLocale,
  currentPath,
  accentColor,
  showLanguageSelector = true,
} = Astro.props as Props;

const navLinks = (Array.isArray(navLinksProp) ? navLinksProp : []).filter(
  (link): link is NavLink => Boolean(link && typeof link.label === 'string' && typeof link.href === 'string')
);
const hasNavLinks = navLinks.length > 0;
const shouldRenderSelector = showLanguageSelector && availableLocales.length > 0;
---

<nav class:list={{ navbar: true, 'navbar--no-links': !hasNavLinks }}>
  <a href={homeHref} class="navbar-brand">
    {brandLogoUrl && (
      <img src={brandLogoUrl} alt={brandLogoAlt || `${brandDisplayName} logo`} class="navbar-logo" loading="lazy" />
    )}
    <span class="navbar-title">{brandDisplayName}</span>
  </a>

  {hasNavLinks && (
    <ul class="navbar-nav">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            target={link.openInNewTab ? '_blank' : undefined}
            rel={link.openInNewTab ? 'noopener noreferrer' : undefined}
          >
            {link.label}
          </a>
        </li>
      ))}
    </ul>
  )}

  <div class="navbar-actions">
    {shouldRenderSelector && (
      <LanguageSelector
        availableLocales={availableLocales}
        currentLang={currentLocale}
        currentPath={currentPath}
      />
    )}
  </div>
</nav>

<style define:vars={{ accent: accentColor }}>
  .navbar {
    background: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1rem 2rem;
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    width: 100%;
    box-sizing: border-box;
    gap: 1.5rem;
  }

  .navbar--no-links {
    grid-template-columns: auto 1fr;
  }

  .navbar-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent, #ff6b35);
    text-decoration: none;
    white-space: nowrap;
  }

  .navbar-logo {
    height: 28px;
    width: auto;
  }

  .navbar-title {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
  }

  .navbar-nav {
    display: flex;
    gap: 1.75rem;
    list-style: none;
    margin: 0;
    padding: 0;
    justify-self: center;
  }

  .navbar-nav a {
    color: #4b5563;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .navbar-nav a:hover {
    color: var(--accent, #ff6b35);
  }

  .navbar-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    justify-self: end;
  }

  @media (max-width: 768px) {
    .navbar {
      padding: 1rem;
      grid-template-columns: 1fr auto;
    }

    .navbar-nav {
      display: none;
    }
  }
</style>
